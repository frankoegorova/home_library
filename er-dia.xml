<?xml version="1.0" encoding="UTF-8"?>
<database name="HomeLibraryDB">
  <tables>
    
    <!-- СПРАВОЧНЫЕ ТАБЛИЦЫ -->
    <table name="age_ratings">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="code" type="VARCHAR(10)" constraint="NOT NULL">Код рейтинга</column>
        <column name="min_age" type="INTEGER" constraint="NOT NULL">Минимальный возраст</column>
        <column name="description" type="TEXT">Описание</column>
      </columns>
    </table>
    
    <table name="genres">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="name" type="VARCHAR(100)" constraint="NOT NULL">Название жанра</column>
        <column name="description" type="TEXT">Описание</column>
      </columns>
    </table>
    
    <table name="locations">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="room" type="VARCHAR(50)">Комната</column>
        <column name="furniture" type="VARCHAR(50)">Шкаф/Стеллаж</column>
        <column name="shelf" type="VARCHAR(50)">Полка</column>
        <column name="description" type="TEXT">Описание места</column>
      </columns>
    </table>
    
    <!-- ОСНОВНЫЕ ТАБЛИЦЫ -->
    <table name="books">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="title" type="VARCHAR(200)" constraint="NOT NULL">Название</column>
        <column name="original_title" type="VARCHAR(200)">Оригинальное название</column>
        <column name="publication_year" type="INTEGER">Год издания</column>
        <column name="publisher" type="VARCHAR(150)">Издательство</column>
        <column name="page_count" type="INTEGER">Количество страниц</column>
        <column name="description" type="TEXT">Описание</column>
        <column name="age_rating_id" type="INTEGER" constraint="FK → age_ratings.id">Возрастной рейтинг</column>
        <column name="isbn" type="VARCHAR(20)">ISBN</column>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Дата добавления</column>
      </columns>
    </table>
    
    <table name="authors">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="last_name" type="VARCHAR(100)">Фамилия</column>
        <column name="first_name" type="VARCHAR(100)">Имя</column>
        <column name="middle_name" type="VARCHAR(100)">Отчество</column>
        <column name="birth_year" type="INTEGER">Год рождения</column>
        <column name="death_year" type="INTEGER">Год смерти</column>
        <column name="country" type="VARCHAR(100)">Страна</column>
        <column name="special_notes" type="TEXT">Особые пометки</column>
        <column name="author_type" type="VARCHAR(50)">Тип авторства</column>
      </columns>
    </table>
    
    <table name="users">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="last_name" type="VARCHAR(100)" constraint="NOT NULL">Фамилия</column>
        <column name="first_name" type="VARCHAR(100)" constraint="NOT NULL">Имя</column>
        <column name="middle_name" type="VARCHAR(100)">Отчество</column>
        <column name="birth_date" type="DATE" constraint="NOT NULL">Дата рождения</column>
        <column name="email" type="VARCHAR(150)">Email</column>
        <column name="phone" type="VARCHAR(20)">Телефон</column>
        <column name="role" type="VARCHAR(20)" default="'guest'">Роль</column>
        <column name="is_active" type="BOOLEAN" default="true">Активен</column>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Дата регистрации</column>
      </columns>
    </table>
    
    <table name="copies">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="book_id" type="INTEGER" constraint="FK → books.id, NOT NULL">Книга</column>
        <column name="inventory_number" type="VARCHAR(50)" constraint="UNIQUE, NOT NULL">Инвентарный номер</column>
        <column name="location_id" type="INTEGER" constraint="FK → locations.id">Место хранения</column>
        <column name="acquisition_date" type="DATE">Дата поступления</column>
        <column name="purchase_price" type="DECIMAL(10,2)">Стоимость приобретения</column>
        <column name="estimated_value" type="DECIMAL(10,2)">Оценочная стоимость</column>
        <column name="condition" type="VARCHAR(20)">Состояние</column>
        <column name="special_notes" type="TEXT">Особые отметки</column>
        <column name="is_available" type="BOOLEAN" default="true">Доступен</column>
      </columns>
    </table>
    
    <!-- СВЯЗУЮЩИЕ ТАБЛИЦЫ -->
    <table name="book_authors">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="book_id" type="INTEGER" constraint="FK → books.id, NOT NULL">Книга</column>
        <column name="author_id" type="INTEGER" constraint="FK → authors.id, NOT NULL">Автор</column>
        <column name="author_order" type="INTEGER" default="1">Порядок авторов</column>
      </columns>
    </table>
    
    <table name="book_genres">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="book_id" type="INTEGER" constraint="FK → books.id, NOT NULL">Книга</column>
        <column name="genre_id" type="INTEGER" constraint="FK → genres.id, NOT NULL">Жанр</column>
      </columns>
    </table>
    
    <!-- ОПЕРАЦИОННЫЕ ТАБЛИЦЫ -->
    <table name="loans">
      <columns>
        <column name="id" type="SERIAL" constraint="PK">ID</column>
        <column name="copy_id" type="INTEGER" constraint="FK → copies.id, NOT NULL">Экземпляр</column>
        <column name="user_id" type="INTEGER" constraint="FK → users.id, NOT NULL">Читатель</column>
        <column name="librarian_id" type="INTEGER" constraint="FK → users.id, NOT NULL">Библиотекарь</column>
        <column name="loan_date" type="DATE" constraint="NOT NULL">Дата выдачи</column>
        <column name="due_date" type="DATE">Срок возврата</column>
        <column name="return_date" type="DATE">Дата возврата</column>
        <column name="age_check_passed" type="BOOLEAN" default="false">Проверка возраста</column>
        <column name="notes" type="TEXT">Примечания</column>
      </columns>
    </table>
    
  </tables>
  
  <relationships>
    <relationship from="books.age_rating_id" to="age_ratings.id" type="N:1" />
    <relationship from="copies.book_id" to="books.id" type="N:1" />
    <relationship from="copies.location_id" to="locations.id" type="N:1" />
    <relationship from="book_authors.book_id" to="books.id" type="M:N" />
    <relationship from="book_authors.author_id" to="authors.id" type="M:N" />
    <relationship from="book_genres.book_id" to="books.id" type="M:N" />
    <relationship from="book_genres.genre_id" to="genres.id" type="M:N" />
    <relationship from="loans.copy_id" to="copies.id" type="1:N" />
    <relationship from="loans.user_id" to="users.id" type="1:N" />
    <relationship from="loans.librarian_id" to="users.id" type="N:1" />
  </relationships>
  
</database>>
