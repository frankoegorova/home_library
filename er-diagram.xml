<mxfile host="app.diagrams.net">
  <diagram name="Page-1" id="RZPy7LJ9Z-LHqu28oYYm">
    <mxGraphModel dx="1044" dy="703" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- ЛЕГЕНДА -->
        <mxCell id="legend" value="&lt;b&gt;ЛЕГЕНДА ER-ДИАГРАММЫ&lt;/b&gt;&lt;br&gt;───────────────────&lt;br&gt;[PK] - Первичный ключ&lt;br&gt;[FK] - Внешний ключ&lt;br&gt;[NN] - NOT NULL&lt;br&gt;&lt;br&gt;&lt;b&gt;МОЩНОСТЬ СВЯЗЕЙ:&lt;/b&gt;&lt;br&gt;1 ─ ровно один&lt;br&gt;0..1 ─ ноль или один&lt;br&gt;* ─ много (0..*)&lt;br&gt;1..* ─ один или много&lt;br&gt;&lt;br&gt;&lt;b&gt;ЦВЕТОВАЯ СХЕМА:&lt;/b&gt;&lt;br&gt;█ Справочные таблицы&lt;br&gt;█ Основные сущности&lt;br&gt;█ Связующие таблицы&lt;br&gt;█ Операционные таблицы&lt;br&gt;█ Аудит и история" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="600" y="10" width="200" height="200" as="geometry" />
        </mxCell>
        
        <!-- =================== СПРАВОЧНИКИ (СИНИЕ) =================== -->
        
        <!-- AGE_RATINGS -->
        <mxCell id="age_ratings" value="&lt;b&gt;ВОЗРАСТНЫЕ РЕЙТИНГИ&lt;/b&gt;&lt;br&gt;(AGE_RATINGS)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• code [NN]&lt;br&gt;• description&lt;br&gt;• min_age [NN]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="160" height="120" as="geometry" />
        </mxCell>
        
        <!-- GENRES -->
        <mxCell id="genres" value="&lt;b&gt;ЖАНРЫ&lt;/b&gt;&lt;br&gt;(GENRES)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• name [NN]&lt;br&gt;• description" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="180" width="160" height="100" as="geometry" />
        </mxCell>
        
        <!-- LOCATIONS -->
        <mxCell id="locations" value="&lt;b&gt;МЕСТОПОЛОЖЕНИЯ&lt;/b&gt;&lt;br&gt;(LOCATIONS)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• room&lt;br&gt;• furniture&lt;br&gt;• shelf&lt;br&gt;• description" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="300" width="160" height="120" as="geometry" />
        </mxCell>
        
        <!-- ROLES -->
        <mxCell id="roles" value="&lt;b&gt;РОЛИ&lt;/b&gt;&lt;br&gt;(ROLES)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• name [NN]&lt;br&gt;• permissions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="440" width="160" height="100" as="geometry" />
        </mxCell>
        
        <!-- =================== ОСНОВНЫЕ СУЩНОСТИ (ЗЕЛЕНЫЕ) =================== -->
        
        <!-- BOOKS -->
        <mxCell id="books" value="&lt;b&gt;КНИГИ&lt;/b&gt;&lt;br&gt;(BOOKS)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• title [NN]&lt;br&gt;• original_title&lt;br&gt;• publication_year&lt;br&gt;• publisher&lt;br&gt;• page_count&lt;br&gt;• description&lt;br&gt;• &lt;b&gt;age_rating_id [FK]&lt;/b&gt;&lt;br&gt;• isbn&lt;br&gt;• created_at" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="260" y="40" width="180" height="200" as="geometry" />
        </mxCell>
        
        <!-- AUTHORS -->
        <mxCell id="authors" value="&lt;b&gt;АВТОРЫ&lt;/b&gt;&lt;br&gt;(AUTHORS)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• last_name&lt;br&gt;• first_name&lt;br&gt;• middle_name&lt;br&gt;• birth_year&lt;br&gt;• death_year&lt;br&gt;• country&lt;br&gt;• special_notes&lt;br&gt;• author_type" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="260" y="260" width="180" height="180" as="geometry" />
        </mxCell>
        
        <!-- USERS -->
        <mxCell id="users" value="&lt;b&gt;ПОЛЬЗОВАТЕЛИ&lt;/b&gt;&lt;br&gt;(USERS)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• last_name [NN]&lt;br&gt;• first_name [NN]&lt;br&gt;• middle_name&lt;br&gt;• &lt;b&gt;birth_date [NN]&lt;/b&gt;&lt;br&gt;• email&lt;br&gt;• phone&lt;br&gt;• created_at&lt;br&gt;• is_active" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="260" y="460" width="180" height="180" as="geometry" />
        </mxCell>
        
        <!-- COPIES -->
        <mxCell id="copies" value="&lt;b&gt;ЭКЗЕМПЛЯРЫ&lt;/b&gt;&lt;br&gt;(COPIES)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• &lt;b&gt;book_id [FK]&lt;/b&gt;&lt;br&gt;• inventory_number [NN]&lt;br&gt;• &lt;b&gt;location_id [FK]&lt;/b&gt;&lt;br&gt;• acquisition_date&lt;br&gt;• purchase_price&lt;br&gt;• estimated_value&lt;br&gt;• condition&lt;br&gt;• special_notes&lt;br&gt;• is_available" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="260" y="660" width="180" height="200" as="geometry" />
        </mxCell>
        
        <!-- =================== СВЯЗУЮЩИЕ ТАБЛИЦЫ (ЖЕЛТЫЕ) =================== -->
        
        <!-- BOOK_AUTHORS -->
        <mxCell id="book_authors" value="&lt;b&gt;КНИГИ_АВТОРЫ&lt;/b&gt;&lt;br&gt;(BOOK_AUTHORS)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• &lt;b&gt;book_id [FK]&lt;/b&gt;&lt;br&gt;• &lt;b&gt;author_id [FK]&lt;/b&gt;&lt;br&gt;• author_order" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="480" y="120" width="150" height="100" as="geometry" />
        </mxCell>
        
        <!-- BOOK_GENRES -->
        <mxCell id="book_genres" value="&lt;b&gt;КНИГИ_ЖАНРЫ&lt;/b&gt;&lt;br&gt;(BOOK_GENRES)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• &lt;b&gt;book_id [FK]&lt;/b&gt;&lt;br&gt;• &lt;b&gt;genre_id [FK]&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="480" y="240" width="150" height="80" as="geometry" />
        </mxCell>
        
        <!-- USER_ROLES -->
        <mxCell id="user_roles" value="&lt;b&gt;ПОЛЬЗ_РОЛИ&lt;/b&gt;&lt;br&gt;(USER_ROLES)&lt;hr&gt;• &lt;b&gt;user_id [FK]&lt;/b&gt;&lt;br&gt;• &lt;b&gt;role_id [FK]&lt;/b&gt;&lt;br&gt;• assigned_at" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="480" y="500" width="150" height="80" as="geometry" />
        </mxCell>
        
        <!-- =================== ОПЕРАЦИОННЫЕ ТАБЛИЦЫ (РОЗОВЫЕ) =================== -->
        
        <!-- BOOK_LOANS -->
        <mxCell id="book_loans" value="&lt;b&gt;ВЫДАЧА КНИГ&lt;/b&gt;&lt;br&gt;(BOOK_LOANS)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• &lt;b&gt;copy_id [FK]&lt;/b&gt;&lt;br&gt;• &lt;b&gt;user_id [FK]&lt;/b&gt;&lt;br&gt;• &lt;b&gt;librarian_id [FK]&lt;/b&gt;&lt;br&gt;• loan_date [NN]&lt;br&gt;• due_date&lt;br&gt;• return_date&lt;br&gt;• age_check_passed&lt;br&gt;• notes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="660" y="300" width="180" height="180" as="geometry" />
        </mxCell>
        
        <!-- =================== АУДИТ И ИСТОРИЯ (СЕРЫЕ) =================== -->
        
        <!-- AUDIT_LOG -->
        <mxCell id="audit_log" value="&lt;b&gt;ЖУРНАЛ АУДИТА&lt;/b&gt;&lt;br&gt;(AUDIT_LOG)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• &lt;b&gt;user_id [FK]&lt;/b&gt;&lt;br&gt;• table_name&lt;br&gt;• record_id&lt;br&gt;• action&lt;br&gt;• old_values&lt;br&gt;• new_values&lt;br&gt;• changed_at&lt;br&gt;• ip_address" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="660" y="500" width="180" height="180" as="geometry" />
        </mxCell>
        
        <!-- COPY_STATUS_HISTORY -->
        <mxCell id="copy_status_history" value="&lt;b&gt;ИСТОРИЯ СОСТОЯНИЙ&lt;/b&gt;&lt;br&gt;(COPY_STATUS_HISTORY)&lt;hr&gt;• &lt;u&gt;id [PK]&lt;/u&gt;&lt;br&gt;• &lt;b&gt;copy_id [FK]&lt;/b&gt;&lt;br&gt;• old_condition&lt;br&gt;• new_condition&lt;br&gt;• changed_by&lt;br&gt;• changed_at&lt;br&gt;• notes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="660" y="700" width="180" height="140" as="geometry" />
        </mxCell>
        
        <!-- =================== СВЯЗИ МЕЖДУ СУЩНОСТЯМИ =================== -->
        
        <!-- Связь: BOOKS → AGE_RATINGS -->
        <mxCell id="link1" value="1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="books" target="age_ratings">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link1_label" value="имеет рейтинг" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="link1">
          <mxGeometry x="-0.3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Связь: BOOKS ↔ AUTHORS (через BOOK_AUTHORS) -->
        <mxCell id="link2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="books" target="book_authors">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link2_1" value="*" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="book_authors" target="authors">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link2_label" value="написана авторами" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="link2">
          <mxGeometry x="0.3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Связь: BOOKS ↔ GENRES (через BOOK_GENRES) -->
        <mxCell id="link3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.6;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="books" target="book_genres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link3_1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="book_genres" target="genres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Связь: BOOKS → COPIES (1:M) -->
        <mxCell id="link4" value="1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="books" target="copies">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link4_label" value="* имеет экземпляры" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="link4">
          <mxGeometry x="0.5" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Связь: COPIES → LOCATIONS -->
        <mxCell id="link5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.3;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="copies" target="locations">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link5_label" value="хранится в" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="link5">
          <mxGeometry x="-0.3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Связь: COPIES → BOOK_LOANS -->
        <mxCell id="link6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.3;entryDx=0;entryDy=0;" edge="1" parent="1" source="copies" target="book_loans">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link6_label" value="* выдаётся" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="link6">
          <mxGeometry x="0.3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Связь: USERS → BOOK_LOANS -->
        <mxCell id="link7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.6;entryDx=0;entryDy=0;" edge="1" parent="1" source="users" target="book_loans">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link7_label" value="* берёт книги" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="link7">
          <mxGeometry x="0.3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Связь: USERS → USER_ROLES -->
        <mxCell id="link8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="users" target="user_roles">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="link8_1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="user_roles" target="roles">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Связь: USERS → AUDIT_LOG (как инициатор действий) -->
        <mxCell id="link9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.8;exitDx=0;exitDy=0;entryX=0;entryY=0.3;entryDx=0;entryDy=0;" edge="1" parent="1" source="users" target="audit_log">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Связь: COPIES → COPY_STATUS_HISTORY -->
        <mxCell id="link10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.8;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="copies" target="copy_status_history">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Связь: BOOK_LOANS → USERS (librarian_id) -->
        <mxCell id="link11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.8;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="book_loans" target="users">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="540" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="link11_label" value="выдал библиотекарь" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="link11">
          <mxGeometry x="0.5" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Заголовок диаграммы -->
        <mxCell id="title" value="&lt;h1&gt;ER-ДИАГРАММА: БАЗА ДАННЫХ &amp;quot;ДОМАШНЯЯ БИБЛИОТЕКА&amp;quot;&lt;/h1&gt;&lt;h3&gt;Связи и структура таблиц&lt;/h3&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="300" y="10" width="300" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
